<div class="container">
  <div class="row">
    <div class="col-lg-3">
      <%= render 'users/sidebar', user:@user %>
    </div>
    <div class="col-lg-8">
      <h4>おきもちの詳細情報</h4>
      <!--いいね機能レンダリング-->
      <%= render 'favo', item:@item %>
      <table  class="table">
        <tr><td>商品名</td><td><%= @item.name %></td></tr>
        <tr><td>お店の名前</td><td><%= @item.shop_name %></td></tr>
        <tr>
          <td>包装</td>
          <td><% if @item.packing %>
              個包装
          <% elsif %>
              同梱
          <% end %>
        </td></tr>
        <tr><td>この商品について</td><td><%= @item.introduction %></td></tr>
        <tr><td>ジャンル</td><td><%= @item.genre.name %></td></tr>
        <tr><td>シチュエーション</td><td><%#= @item.item_situation_ids.situation %></td></tr>
        <tr><td>
          <% if @item.post_images.present? %>
            <% @item.post_images.each do |image| %>
             <%= attachment_image_tag image, :photo, size: "200x200" %>
            <% end %>
          <% end %>
        </td></tr>

        </table>
        <% if @item.user_id == current_user.id %>
          <%= link_to '編集', edit_item_path(@item.id), class:"btn btn-outline-success" %>
          <%= link_to '削除', item_path(@item),method: :delete, data: { confirm: "削除してよろしいですか？" } ,
            class:"btn btn-outline-danger"%>
        <% end %>
<!--ここから評価-->
        <%= form_with(model: [@item, @review], method: :post) do |f| %>
        <div class="form-group row" id="star">
          <%= f.label :rate,'評価',class:'col-md-3 col-form-label' %>
          <%= f.hidden_field :rate, id: :review_star %>
        </div>

<!-- 評価javascript -->
        <script>
          $('#star').raty({
            size     : 20,
            starOff:  '<%= asset_path('star-off.png') %>',
            starOn : '<%= asset_path('star-on.png') %>',
            starHalf: '<%= asset_path('star-half.png') %>',
            scoreName: 'review[rate]',
            half: true,
          });
          </script>
          <%= f.submit '投稿する', class:"btn btn-success" %>
        <% end %>
<!--評価の表示 -->
        <% @item.reviews.each do |ir| %>
          <%= ir.rate %>点

     <!--星評価-->
          <div id="star-rate-<%= ir.id %>"></div>
          <script>
          $('#star-rate-<%= ir.id %>').raty({
            size: 36,
            starOff:  '<%= asset_path('star-off.png') %>',
            starOn : '<%= asset_path('star-on.png') %>',
            starHalf: '<%= asset_path('star-half.png') %>',
            half: true,
            readOnly: true,
            score: <%= ir.rate %>,
          });
          </script>
          <% end %>

<!--ここからコメン投稿-->

        <div class="new-comment">
          <%= form_with(model:[@item, @comment], local: true) do |f| %>
            <%= f.text_area :body,placeholder: "こちらにコメントをお書きください", size: "30x3" %>
            <%= f.submit '送信する' %>
          <% end %>
        </div>
<!--コメント表示-->
        <div class="comments">
          <p>コメント件数：<%= @item.comments.count %></p>
          <% @item.comments.each do |comment| %>
            <%= comment.user.name %>
            <%= comment.created_at.strftime('%Y/%m/%d') %>
            <%= comment.body %>
            <% if comment.user == current_user %>
              <div class="comment-delete">
                <%= link_to "削除",  item_comment_path(comment.item,comment), method: :delete %>
              </div>
            <% end %>
          <% end %>
        </div>
      </div>
  </div>
</div>
